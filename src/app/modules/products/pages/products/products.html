<div class="container">
  <p-card>
    <p-table
      #table
      [value]="products()"
      dataKey="id"
      [globalFilterFields]="['code', 'description', 'price', 'stock', 'createdAt']"
      [paginator]="true"
      [rows]="5"
      [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
      size="small"
      stripedRows>
      <ng-template #caption>
        <div class="d-flex justify-content-between pb-2">
          <p-button outlined severity="secondary" icon="pi pi-plus" label="Nuevo" (click)="onAdd()" />
          <p-icon-field iconPosition="left">
            <p-inputicon>
              <i class="pi pi-search"></i>
            </p-inputicon>
            <input pInputText [style]="{'width': '400px'}" (input)="table.filterGlobal($event.target.value, 'contains')" placeholder="Buscar" />
          </p-icon-field>
        </div>
      </ng-template>
      <ng-template #header>
        <tr>
          <th>C贸digo</th>
          <th>Descripci贸n</th>
          <th>Imagen</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Fecha de alta</th>
          <th>Acciones</th>
        </tr>
      </ng-template>
      <ng-template #body let-product>
        <tr>
          <td>{{ product.code }}</td>
          <td>{{ product.description }}</td>
          <td>
            <img
              [src]=[product.image]
              [alt]="product.description"
              class="rounded"
              style="width: 100px"
            />
          </td>
          <td>{{ product.price | currency }}</td>
          <td>{{ product.stock }} pzs </td>
          <td>{{ product.createdAt | date:'short' }}</td>
          <td>
            <p-button class="mr-2" icon="pi pi-pencil" (click)="onEdit(product)" severity="secondary" rounded />
            <p-button icon="pi pi-trash" (click)="onDelete(product)" severity="danger" rounded />
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<p-dialog
  [header]="title"
  [modal]="true"
  [(visible)]="visible"
  [style]="{ width: '20rem' }"
  (onHide)="onHide()">
  <form class="d-flex flex-column" [formGroup]="productForm" (ngSubmit)="onSubmit()">

    <div class="flex flex-column gap-1 mb-2">
      <label for="code">C贸digo</label>
      <input pInputText id="code" formControlName="code"/>
    </div>

    <div class="flex flex-column gap-1 mb-2">
      <label for="description">Descripci贸n</label>
      <input pInputText id="description" formControlName="description"/>
    </div>

    <div class="flex flex-column gap-1 mb-2">
      <label for="image">Url de imagen</label>
      <input pInputText id="image" formControlName="image"/>
    </div>

    <div class="flex flex-column gap-1 mb-2">
      <label for="price">Precio</label>
      <p-input-number formControlName="price" mode="currency" inputId="price" currency="MXN" locale="es-MX" />
    </div>

    <div class="flex flex-column gap-1 mb-2">
      <label for="stock">Stock</label>
      <p-input-number formControlName="stock" mode="decimal" locale="es-MX" [minFractionDigits]="2" inputId="stock"/>
    </div>

    <div class="flex flex-column gap-1 mb-2">
      <label for="stock">Tiendas</label>
      <p-multi-select
        [options]="stores"
        formControlName="storeAccess"
        optionLabel="name"
        optionValue="id"
        [filter]="true"
        filterBy="name"
        [showClear]="true"
        placeholder="Seleccione una tienda">
      </p-multi-select >
    </div>

    <div class="d-flex justify-content-end gap-2 pt-2">
      <p-button label="Cancel" severity="secondary" (click)="visible = false" />
      <p-button label="Save" (click)="onSubmit()" />
    </div>

  </form>
</p-dialog>
